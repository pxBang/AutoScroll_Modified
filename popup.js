document.addEventListener("DOMContentLoaded",()=>{chrome.storage.local.get("my_user_id",e=>{let t=e.my_user_id;if(t)"undefined"!=typeof amplitude?(amplitude.getInstance().init("ac9c2f8739b8ebf09da5c0786e2ba579",t,{defaultTracking:!0}),chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e[0],l="";if(t&&t.url)try{l=new URL(t.url).hostname}catch(n){}amplitude.getInstance().logEvent("POPUP_OPENED",{domain:l})})):console.error("Amplitude не определен")});let e=document.getElementById("tab-continuous"),t=document.getElementById("tab-stepped"),l=document.getElementById("continuous-options"),n=document.getElementById("stepped-options"),a=document.getElementById("scroll-speed"),s=document.getElementById("scroll-speed-value"),o=document.getElementById("scroll-distance"),i=document.getElementById("scroll-distance-value"),r=document.getElementById("scroll-interval"),d=document.getElementById("scroll-interval-value"),c=document.getElementById("toggle-scroll"),u=document.getElementById("show-float-button"),g=document.getElementById("main-content"),v=document.getElementById("reload-content"),y=document.getElementById("reload-page"),$=!1,h="continuous",p=!1;function m(){chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e[0];chrome.storage.local.get("tabRequiresReload",e=>{let l=e.tabRequiresReload||{};if(l[t.id]){p=!1,g.style.display="none",v.style.display="block";return}chrome.tabs.sendMessage(t.id,{action:"getStatus"},e=>{chrome.runtime.lastError?(p=!1,g.style.display="none",v.style.display="block",chrome.storage.local.get("tabRequiresReload",e=>{let l=e.tabRequiresReload||{};l[t.id]=!0,chrome.storage.local.set({tabRequiresReload:l})})):(p=!0,g.style.display="block",v.style.display="none",e&&e.isScrolling?(c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg> Stop Scrolling',$=!0):(c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> Start Scrolling',$=!1))})})})}function w(){$&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.sendMessage(e[0].id,{action:"updateSettings",speed:parseInt(a.value),distance:20*parseInt(o.value),interval:1e3*parseInt(r.value)})})}function E(a){h=a,"continuous"===a?(e.classList.add("active"),t.classList.remove("active"),l.style.display="block",n.style.display="none"):(e.classList.remove("active"),t.classList.add("active"),l.style.display="none",n.style.display="block"),b(),$&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.sendMessage(e[0].id,{action:"stopScroll"}),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> Start Scrolling',$=!1})}function b(){let e={mode:h,speed:a.value,distance:o.value,interval:r.value,showFloatButton:u.checked};chrome.storage.sync.set({settings:e})}function _(){chrome.storage.sync.get("settings",e=>{if(e.settings){E(h=e.settings.mode||"continuous");let t=parseInt(e.settings.speed);isNaN(t)&&(t=3),a.value=t,s.textContent=t;let l=parseInt(e.settings.distance)||2;o.value=l,i.textContent=l;let n=parseInt(e.settings.interval)||2;r.value=n,d.textContent=n,u.checked=void 0===e.settings.showFloatButton||e.settings.showFloatButton}else a.value=3,s.textContent="3",o.value=2,i.textContent="2",r.value=2,d.textContent="2",b()})}y.addEventListener("click",()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e[0];try{chrome.storage.local.get("my_user_id",e=>{let l=e.my_user_id;if(l&&"undefined"!=typeof amplitude){let n="";if(t&&t.url)try{n=new URL(t.url).hostname}catch(a){}amplitude.getInstance().logEvent("RELOAD_PAGE_CLICK",{domain:n,tabId:t.id})}})}catch(l){console.error("Ошибка при отправке события в Amplitude:",l)}chrome.storage.local.get("tabRequiresReload",e=>{if(e.tabRequiresReload&&e.tabRequiresReload[t.id]){let l=e.tabRequiresReload;delete l[t.id],chrome.storage.local.set({tabRequiresReload:l})}chrome.tabs.reload(t.id),window.close()})})}),e.addEventListener("click",()=>{E("continuous")}),t.addEventListener("click",()=>{E("stepped")}),a.addEventListener("input",()=>{s.textContent=a.value,b(),w()}),o.addEventListener("input",()=>{i.textContent=o.value,b(),w()}),r.addEventListener("input",()=>{d.textContent=r.value,b(),w()}),u.addEventListener("change",()=>{b();let e=u.checked;chrome.tabs.query({},t=>{t.forEach(t=>{t.url&&(t.url.startsWith("http://")||t.url.startsWith("https://"))&&chrome.tabs.sendMessage(t.id,{action:"updateFloatButton",showFloatButton:e},()=>{chrome.runtime.lastError})})})}),_(),m(),c.addEventListener("click",()=>{$?(chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.sendMessage(e[0].id,{action:"stopScroll"})}),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> Start Scrolling',$=!1):(b(),chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e[0],l="";if(t&&t.url)try{l=new URL(t.url).hostname}catch(n){}chrome.storage.local.get("my_user_id",e=>{let t=e.my_user_id;t&&amplitude.getInstance().logEvent("START_SCROLL",{mode:h,speed:parseInt(a.value),distance:parseInt(o.value),interval:parseInt(r.value),showFloatButton:u.checked,domain:l})}),chrome.tabs.sendMessage(t.id,{action:"startScroll",mode:h,speed:parseInt(a.value),distance:20*parseInt(o.value),interval:1e3*parseInt(r.value),showFloatButton:u.checked})}),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg> Stop Scrolling',$=!0)});let f=document.querySelectorAll('.rating-group input[name="fst"]');f.forEach(e=>{e.addEventListener("change",e=>{let t=e.target.value;try{chrome.storage.local.get("my_user_id",e=>{let l=e.my_user_id;l&&"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("RATING_SELECTED",{rating:parseInt(t)})})}catch(l){console.error("Ошибка при отправке события в Amplitude:",l)}})});let B=document.querySelectorAll(".rating-group label a");B.forEach((e,t)=>{e.addEventListener("click",l=>{l.preventDefault();let n=t+1,a=e.href;try{chrome.storage.local.get("my_user_id",e=>{let t=e.my_user_id;t&&"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("RATING_CLICK",{rating:n,url:a}),setTimeout(()=>{chrome.tabs.create({url:a})},100)})}catch(s){console.error("Ошибка при отправке события в Amplitude:",s),chrome.tabs.create({url:a})}})})});